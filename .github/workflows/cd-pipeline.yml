name: CD

on:
  push:
   tags:
     - '*'

jobs:
  release:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v2
    - name: Get version
      id: get_version
      run: echo ::set-output name=version::${GITHUB_REF/refs\/tags\//}
    - name: Use Node.js
      uses: actions/setup-node@v2
      with:
        node-version: "18.x"
    - name: Install dependencies
      run: npm install
    - name: Install pkg globally
      run: npm install -g pkg
    - name: Create binary
      run: pkg . -o readme-generator-for-helm
    - name: Set SHA
      id: shasum
      run: |
        echo ::set-output name=sha::"$(shasum -a 256 ./readme-generator-for-helm | awk '{printf $1}')"
    - name: Release
      uses: softprops/action-gh-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    #- name: Bump homebrew-core formula
    #  uses: mislav/bump-homebrew-formula-action@v1
    #  if: "!contains(github.ref, '-')"
    #  env:
    #    COMMITTER_TOKEN: ${{ secrets.BREW_TOKEN }}
    #  with:
    #    formula-name: readme-generator-for-helm
